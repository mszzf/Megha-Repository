<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <link rel='stylesheet' href='../css/bootstrap.css' />
    <title>My Travels</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places,weather&sensor=true"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
	<script type="text/javascript" src="../js/plugins/raty-2.5.2/lib/jquery.raty.js"></script>
    <script type="text/javascript" src="../js/bootstrap.js"></script>
    <script type="text/javascript" src="../js/soapclient.js"></script>
    <script type="text/javascript" src="../js/webServices.js"></script>


    <style>
        .bar {
            height: 220px;
            float: left;
            width: 60px
        }
        .bar-container {
            width: 150px;
            float: left;
            padding-top: 70px;
            color: brown;
            font: 17px Arial bold;
            margin-left: 20px;
            position: absolute;
        }
        .emoticon-container {
            float: left;
            padding-top: 70px;
            color: brown;
            font: 17px Arial bold;
            margin-left: 20px;
        }
        .smile-container {
            float: left;
            padding-top: 50px;
            color: black;
            font: 17px Arial bold;
            margin-left: 300px;
        }
        .outside-container {
            float: left;
            color: black;
            font: 25px Arial bold;
            margin-left: 20px;
        }
        .gauge {
            float: left;
            width: 100px
        }
        .bigger-container {
            float: left;
            padding-top: 0px;
            margin-left: 130px;
        }
        .left {
            float: left
        }
        .bar-label {
            margin-bottom: 15px;
            display: inline-block;
            color: black
        }
        .backg {
            background-color: black;
            clear: both
        }
        .ui-slider-range.ui-widget-header {
            background: brown;
        }
        .backb {
            background-image: url("best.png")
        }
        h1 {
            float: left;
            margin-left: 500px;
            font: 50px Arial bold;
            color: black
        }
        h1:hover {
            cursor: pointer;
            color: #f00;
        }
        h1:active {
            color: #555;
        }
        .clear {
            clear: both
        }
        .box-text {
            width: 300px;
            height: 70px;
            background-color: green;
            box-shadow: 10px 10px 5px #888888;
        }
        .box-heading {
            width: 350px;
            height: 100%;
            background-color: blue;
            box-shadow: 10px 10px 5px #888888;
        }
    </style>
	<script>
	
var MyMap = function () {
    this.name = 'megha';
    this.latitude = 0;
    this.longitude = 0;
    this.center = 0;
    this.zip = '66223';
    this.zoom = 15;
    this.mapTypeId = google.maps.MapTypeId.ROADMAP;
    this.mapOptions = '';
    this.nearMeType = '';
    this.radius = 5000;
    this.source = '';
    this.destination = '';
    this.soapContainer = '';
    this.wunder = new Object();
    this.wunder.key = 'f8c3066322c719fa';
    this.wunder.keyMegha = 'f34104476d53986f';
    this.wunder.features = 'conditions';

    google.load("visualization", "1", {
        packages: ["corechart"]
    });
    google.load('visualization', '1', {
        packages: ['gauge']
    });
}


MyMap.prototype = {
    init: function (containerId, which, type, fromId, toId) {
        var args = [];
        args.push(containerId);
        args.push(which);
        args.push(type);
        args.push(fromId);
        args.push(toId);
        this.setCurrentLocation(this.initMap, args);
    },
    setCurrentLocation: function (callbackFunc, args) {
        var that = this;
        if (this.zip) {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                'address': this.zip
            }, function (location, status) {
                if (status == 'OK') {
                    that.latitude = location[0].geometry.location.lat();
                    that.longitude = location[0].geometry.location.lng();
                    callbackFunc.apply(that, args);
                }
            });
        } else if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                that.latitude = position.coords.latitude;
                that.longitude = position.coords.longitude;
                callbackFunc.apply(that, args);
            });
        }
    },
    initMap: function (containerId, which, type, fromId, toId) {
        var container = document.getElementById(containerId);;
        var that = this;
        that.center = new google.maps.LatLng(that.latitude, that.longitude);
        that.mapOptions = {
            zoom: that.zoom,
            mapTypeId: that.mapTypeId,
            center: that.center
        }
        switch (which) {
       
        case 'n':
            that.nearMeType = type;
            if (container) {
                that.nearMe(container);
            }
            break;
        case 'w':
            if (container) {
                that.weather(container);
            }
            break;
        case 'l':

            var userName = document.getElementById('userid').value;
            var password = document.getElementById('password').value;
            $.ajax({
                url: "http://192.168.1.9/aspnet_client/WcfService1/WcfService1/WcfService1/Service1.svc/data/" + userName + "/" + password
            }).then(function (data) {
                if (data != 'false') {
                    document.getElementById('userName').innerHTML = data;
                }
            });

        }
    },
    weather: function (container) {

        var myOptions = {
            zoom: 8,
            mapTypeId: this.mapTypeId,
            center: this.mapOptions.center
        }
        var weatherLayer = new google.maps.weather.WeatherLayer({
            temperatureUnits: google.maps.weather.TemperatureUnit.FAHRENHEIT
        });
        var map = new google.maps.Map(container, myOptions);
        weatherLayer.setMap(map);

        var cloudLayer = new google.maps.weather.CloudLayer();
        cloudLayer.setMap(map);
    },
    nearMe: function (container) {
        var request = {
            location: this.mapOptions.center,
            radius: this.radius,
            types: [this.nearMeType]
        };

        var myOptions = {
            zoom: 12,
            mapTypeId: this.mapTypeId,
            center: this.mapOptions.center
        }
        var map = new google.maps.Map(container, myOptions);
        var that = this;
        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, function (results, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {
                    var place = results[i];
                    that.createMarker(map, results[i]);
                }
            }
        });

    },
    createMarker: function (map, result) {
        var marker = new google.maps.Marker({
            map: map,
            position: result.geometry.location
        });
    },
    charts: function (containerId) {
        var data = google.visualization.arrayToDataTable([
            ['Task', 'Hours per Day'],
            ['Los Angeles', 15],
            ['Vegas', 20]
        ]);

        var options = {
            title: 'Most Economic',
            width: 400,
            height: 240,
            colors: ['#e0440e', '#e6693e']

        };

        var chart = new google.visualization.PieChart(document.getElementById(containerId));
        chart.draw(data, options);
    },
    drawGauge: function (containerId, ci) {
        var data = google.visualization.arrayToDataTable([
            ['Label', 'Value'],
            ['C.I.', ci]
        ]);

        var options = {
            width: 400,
            height: 400,
            redFrom: -2,
            redTo: -0.5,
            greenFrom: -0.5,
            greenTo: 0.5,
            yellowFrom: 0.5,
            yellowTo: 2,
            redColor: '#FF9900',
            minorTicks: 20,
            min: -2,
            max: 2
        };

        var chart = new google.visualization.Gauge(document.getElementById(containerId));
        chart.draw(data, options);
    },
    currentTemperature: function (updateExternalData) {


        var externalData = new Object();
        var that = this;
        this.setCurrentLocation(function () {

            var urlI = "http://api.wunderground.com/api/" + that.wunder.keyMegha + "/" + that.wunder.features +
                "/q/" + that.latitude + "," + that.longitude + ".json";

            $.ajax({
                url: urlI,
                dataType: "jsonp",
                success: function (parsed_json) {
                    // var location = parsed_json['location']['city'];
                    var location = "";
                    var temp_f = parsed_json['current_observation']['temp_f'];
                    var relative_humidity = parsed_json['current_observation']['relative_humidity'];

                    externalData.temperature = temp_f;
                    externalData.humidity = relative_humidity;
                    updateExternalData.call(undefined, externalData);

                }
            });
        }, []);
    },

    internalTemperature: function (updateInternalData) {

        var internalData = new Object();


        $.ajax({
            url: 'http://php2.umkc.edu/sce/e-save/demo/esavedemo/getRemoteSensorData.php',

            type: 'get',
            dataType: 'json',
            //headers: { 'Access-Control-Allow-Origin': '*' },
            //crossDomain: true,
            success: function (data) {
                $.each(data, function (key, val) {
                    temp = val.Temperature;
                    var volt = val.Humidity;
                    humidity = parseFloat(((volt / 3000) - 0.1515) / .00636).toFixed(0);

                    internalData.temperature = temp;
                    internalData.humidity = humidity;

                    updateInternalData.call(undefined, internalData)



                });

            }


        });
    }
}
var myMap = new MyMap();

var Utils = function () {
    
}


Utils.prototype = {
    init: function (containerId, which, type, fromId, toId) {
        var args = [];
        args.push(containerId);
        args.push(which);
        args.push(type);
        args.push(fromId);
        args.push(toId);
        this.setCurrentLocation(this.initMap, args);
    },
    setCurrentLocation: function (callbackFunc, args) {
        var that = this;
        if (this.zip) {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                'address': this.zip
            }, function (location, status) {
                if (status == 'OK') {
                    that.latitude = location[0].geometry.location.lat();
                    that.longitude = location[0].geometry.location.lng();
                    callbackFunc.apply(that, args);
                }
            });
        } else if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                that.latitude = position.coords.latitude;
                that.longitude = position.coords.longitude;
                callbackFunc.apply(that, args);
            });
        }
    }
	}
	
	var utils = new Utils();


var GoogleMap = function () {
    this.name = 'megha';
    this.address = '';
    this.latitude = 0;
    this.longitude = 0;
    this.center = 0;
    this.zip = '66223';
    this.zoom = 15;
    this.mapTypeId = google.maps.MapTypeId.ROADMAP;
    this.mapOptions = '';
    this.nearMeType = '';
    this.radius = 5000;
    this.source = '';
    this.destination = '';
	this.directionContainer='';
	this.callback='';

    google.load("visualization", "1", {
        packages: ["corechart"]
    });
    google.load('visualization', '1', {
        packages: ['gauge']
    });
}


GoogleMap.prototype = {
    setLongitudeLatitude: function (address) {
        
		var that = this;
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                'address': address
            }, function (location, status) {
                if (status == 'OK') {
                    that.address = address;
                    that.latitude = location[0].geometry.location.lat();
                    that.longitude = location[0].geometry.location.lng();
                    that.callback.call(that);
                }
            });
        }
    ,
    centeredMap: function (container, center) {
var mapOptions = {
            zoom: 8,
            mapTypeId: this.mapTypeId,
            center: center
        }       
	   var map = new google.maps.Map(container, mapOptions);
        var infowindow = new google.maps.InfoWindow({
            map: map,
            position: center,
            content: 'I am here'
        });
    },
    direction: function (mapContainer, directionContainer, source, destination, places) {
        mapContainer.innerHTML='';
        directionContainer.innerHTML='';
		var myOptions = {
            zoom: 8,
            mapTypeId: this.mapTypeId,
            center: new google.maps.LatLng(0, 0)
        }
        var map2 = new google.maps.Map(mapContainer, myOptions);

        var directionsDisplay = new google.maps.DirectionsRenderer();
        directionsDisplay.setMap(map2);
		
		var waypts = [];
  
		if(places){
		
		for (var i = 0; i < places.length; i++) {
		var place = places[i];
      waypts.push({
          location:place,
          stopover:true
      });
    }
	}
  
  
        var request = {
            origin: source,
            destination: destination,
      waypoints: waypts,
      optimizeWaypoints: false,
  
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        };

        var directionsService = new google.maps.DirectionsService();
        directionsService.route(request, function (response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                var route = response.routes[0];
                var leg = route.legs[0]
                var steps = leg.steps;
                var instructions = '';
                for (var i = 0; i < steps.length; i++) {
                    var step = steps[i];
                    instructions = instructions + step.instructions + '<br/>';
                }
                if (directionContainer) {
                    directionContainer.innerHTML = instructions;
                }

            }
        });
    },
    weather: function (container) {

        var myOptions = {
            zoom: 8,
            mapTypeId: this.mapTypeId,
            center: this.mapOptions.center
        }
        var weatherLayer = new google.maps.weather.WeatherLayer({
            temperatureUnits: google.maps.weather.TemperatureUnit.FAHRENHEIT
        });
        var map = new google.maps.Map(container, myOptions);
        weatherLayer.setMap(map);

        var cloudLayer = new google.maps.weather.CloudLayer();
        cloudLayer.setMap(map);
    },
    nearMe: function (container) {
        var request = {
            location: this.mapOptions.center,
            radius: this.radius,
            types: [this.nearMeType]
        };

        var myOptions = {
            zoom: 12,
            mapTypeId: this.mapTypeId,
            center: this.mapOptions.center
        }
        var map = new google.maps.Map(container, myOptions);
        var that = this;
        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, function (results, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {
                    var place = results[i];
                    that.createMarker(map, results[i]);
                }
            }
        });

    },
    createMarker: function (map, result) {
        var marker = new google.maps.Marker({
            map: map,
            position: result.geometry.location
        });
    },
    charts: function (containerId) {
        var data = google.visualization.arrayToDataTable([
            ['Task', 'Hours per Day'],
            ['Los Angeles', 15],
            ['Vegas', 20]
        ]);

        var options = {
            title: 'Most Economic',
            width: 400,
            height: 240,
            colors: ['#e0440e', '#e6693e']

        };

        var chart = new google.visualization.PieChart(document.getElementById(containerId));
        chart.draw(data, options);
    },
    drawGauge: function (containerId, ci) {
        var data = google.visualization.arrayToDataTable([
            ['Label', 'Value'],
            ['C.I.', ci]
        ]);

        var options = {
            width: 400,
            height: 400,
            redFrom: -2,
            redTo: -0.5,
            greenFrom: -0.5,
            greenTo: 0.5,
            yellowFrom: 0.5,
            yellowTo: 2,
            redColor: '#FF9900',
            minorTicks: 20,
            min: -2,
            max: 2
        };

        var chart = new google.visualization.Gauge(document.getElementById(containerId));
        chart.draw(data, options);
    }
}
var googleMap = new GoogleMap();







var Soap = function () {
        this.url = 'http://localhost:7286/WebService.asmx';
        this.soapClientParameters = new SOAPClientParameters();
    }

Soap.prototype = {
    invoke: function (functionName, callbackFunction, objectOfCallbackFunction) {
        var that = this;
        var url = this.url;
        SOAPClient.invoke(url, functionName, that.soapClientParameters, true, function (response) {
            callbackFunction.call(objectOfCallbackFunction, response);
        });

    }
}
var soap = new Soap();





var Place = function () {
        this.id = '';
        this.name = '';
        this.latitude = '';
        this.longitude = '';
        this.additionalInfo = '';
        this.image = '';
    }

Place.prototype = {
    init: function (id, name, latitude, longitude, additionalInfo, image) {
        this.id = id;
        this.name = name;
        this.latitude = latitude;
        this.longitude = longitude;
        this.additionalInfo = additionalInfo;
        this.image = image;
    }

}

var place = new Place();

var Route = function () {
        this.id = '';
        this.name = '';
        this.price = 0;
        this.rating = 0;
        this.createdBy = '';
        this.source = '';
        this.destination = '';
        this.places = [];
		this.currentPlace = 0;
		this.allRoutes = [];
		this.callback='';
		this.published=false;
		
    }

Route.prototype = {
    addPlace: function (id, name, latitude, longitude, additionalInfo, image) {
        var place = new Place();
        place.init(id, name, latitude, longitude, additionalInfo, image);
        this.places.push(place);
        if (this.places.length == 1) {
            this.source = place;
        }
        this.destination = place;
    },
    publish: function () {
       this.published=false;
	   for (var i = 0; i < this.places.length; i++) {
            var place = this.places[i];
            var soap = new Soap();
            soap.soapClientParameters.add("routeName", this.name);
            
            soap.soapClientParameters.add("routeRating", this.rating);
            soap.soapClientParameters.add("routePrice", this.price);
			soap.soapClientParameters.add("placeName", place.name);
            soap.soapClientParameters.add("latitude", place.latitude);
            soap.soapClientParameters.add("longitude", place.longitude);
            soap.soapClientParameters.add("imageUrl", place.image);
            soap.soapClientParameters.add("additionalInfo", place.additionalInfo);
            soap.soapClientParameters.add("createdBy", this.createdBy);
            soap.invoke('insertPlaces', this.getPublishResponse,this);
			if(i==this.places.length-1){
			
		this.published=true;
			}
        }

    },

    getPublishResponse: function (response) {
	this.callback.call(this,response);
    },
    Trace: function (routeName){
	 var soap = new Soap();
            soap.soapClientParameters.add("", '' );
            soap.invoke('insert', publishSuccess, place);
	
	},
	
	getRoute: function (routeName){
	 var soap = new Soap();
     soap.soapClientParameters.add("routeName", routeName );
            
	 soap.invoke('GetRoute', this.getRouteResponse, this);
	
	},
	getRouteResponse: function(response){
	this.places=[];
	var routeJson = jQuery.parseJSON(response)[0];
	this.id=routeJson.Id;
	this.name=routeJson.Name;
	var places = routeJson.Places;
	for(var i=0;i<places.length;i++){
	this.addPlace(places[i].Id, places[i].Name, places[i].Latitude, places[i].Longitude, places[i].AdditionalInfo, places[i].ImageUrl);
	
	}
	
	this.callback.call(this);
	
	
	},
    getAllRoutes: function (){
	 var soap = new Soap();
     soap.invoke('GetRoutes', this.getAllRoutesResponse, this);
	 
	},
	getAllRoutesResponse: function(response){
	var json = jQuery.parseJSON(response);
	this.allRoutes=[];	
	for(var j=0;j<json.length;j++){
	var route = new Route();
	route.id=json[j].Id;
	route.name=json[j].Name;
	route.price=json[j].Price;
	route.rating=json[j].Rating;
	var places = json[j].Places;
	for(var i=0;i<places.length;i++){
	route.addPlace(places[i].Id, places[i].Name, places[i].Latitude, places[i].Longitude, places[i].AdditionalInfo, places[i].ImageUrl);
	}
	this.allRoutes.push(route);
	}
	
	
	this.callback.call(this);
	
	
	
	}



}


var route = new Route();
//route.getAllRoutes();
//route.name='USA';
//route.createdBy='Megha';
//route.addPlace('Detroit, MI', 'cold', '');
//route.addPlace('Colorado, DE', 'Hot', '');
//route.publish();
//route.getAllRoutes();



var Twitter = function () {
    this.consumerKey = 'mQ1Lf9xmdAI8YtRN7HdFHQ';
    this.consumerSecret = '2pi1AvqnCzjFSmRzKSgo8cTDmHvPa7SQAroSCmWnAU';
    this.accessToken = '2315844691-ROnNOpaoTecDHq2zMChJZPxMzUiNGx11IGfzYuP';
    this.accessTokenSecret = 'OAWJbdnpu8DOvhzJKuOSlCFIsLzEtlSLWRd8fjZ9nLml8';
    //this.getToken();
}

Twitter.prototype = {

    encodeRfc1738: function (string) {
        return encodeURIComponent(string);

    },

    getToken: function () {
        var keySecret = this.key + ':' + this.secret;
        var encodedKeySecret = window.btoa(keySecret);

        $.ajax({
            type: "GET",
            url: 'https://api.twitter.com/1.1/statuses/user_timeline.json?count=100&screen_name=twitterapi',
            dataType: 'json',
            //beforeSend: function(xhrObj){
            //    xhrObj.setRequestHeader("Authorization","Bearer " + this.accessTokenSecret);
            // },
            error: function () {
                alert("Fail");
            },
            success: function () {
                alert("Success");
            }
        });

    },

    getTweet: function (tweetId, containerId) {

        tweetId = '446478364551827457';
        var url1 = 'https://api.twitter.com/1/statuses/oembed.json?id=' + tweetId;

        $.ajax({
            type: "GET",
            url: url1,
            dataType: 'jsonp',
            error: function () {
                alert("Fail");
            },
            success: function (data) {
                var html = data['html'];
                $("#" + containerId).html(html);
            }
        });

    },
    getTweetIds: function (id) {
        var url1 = 'http://localhost/aspnet_client/Twitter/WcfService1/Service1.svc/data/10';
        var that = this;
        $.ajax({
            type: "GET",
            url: url1,
            dataType: 'json',
            error: function () {
                alert("Fail");
            },
            success: function (data) {
                //var d = data['statuses']['metadata']['id'];
                var obj = jQuery.parseJSON(data);
                var ids = [];
                for (var i = 0; i < obj.statuses.length; i++) {
                    ids.push(obj.statuses[i].id);
                }
                that.populateTweets(ids);

            }
        });
    },
    populateTweets: function (ids) {
        $('#2').html('');
        for (var i = 0; i < ids.length; i++) {
            $('#2').html($('#2').html() + "<div id='twitter" + i + "'></div>");
        }

        for (var i = 0; i < ids.length; i++) {
            this.getTweet(ids[i], "twitter" + i);
        }
    }




}

var twitter = new Twitter();


var FourSquare = function () {
    this.owner = 'Megha Sharma';
    this.clientId1 = 'QSQI4BKJRGKV0NPDNBNAECRP0U3YKX2KMZIY01HZYDIKVSST';
    this.clientSecret1 = 'BUQC5DBCRYTQPR3KHFOLNMHPE1Z2MYD0BW4Z1CO1V2NFK21S';
    this.redirectUri = 'http://192.168.56.1/html/destinations.html';
    this.accessToken1 = '0WS4RAHRWBBSIWAFKIUXJRED1CUVFEAYLUKDNDMHY2WERL4N';
	this.clientId2= 'JHQXGEMU4IRCKSW5YITRWY5T1R2E0NNI0B3Y5B2ZMCUEOJSW';
    this.clientSecret2 = 'IU0WFMRIZJ5P0LTXDBPUKKQBWH0YWENXMDIXO4QJPMQLGLFX';
    this.accessToken2 = 'ZMFOV5NZT5FMGNASDA25RJQV4G00S0HK1IK12VOAFVRC1K3J';
	this.clientId = 'UN3Q2X2HIPPLBTLEXRJA2JR5QGZ30DVMDVPEBOVLR0O4PP0N';
    this.clientSecret = 'HSFI2PFCHUQEWKQ4NVXDBC0TEVCEE12HWK2V1VB1SIM1C1MJ';
    this.accessToken ='5LHQKNQPAZDPKUQY0WGWOVLOMMSTXPXCO5J2VJ5FOBGLU5IH';
	
    this.ll = '';
    this.near = 'Kansas City, MO';
	this.query='Hilton President Kansas City'
	this.callback='';

}

FourSquare.prototype = {

    encodeRfc1738: function (string) {
        return encodeURIComponent(string);

    },

    getToken: function () {
        window.location = 'https://foursquare.com/oauth2/authenticate?client_id=' + this.clientId + '&response_type=token&redirect_uri=' + this.redirectUri;

    },

    explore: function (latitude, longitude, query, limit) {


        var url1 = 'https://api.foursquare.com/v2/venues/explore?v=20140403&oauth_token=' + this.accessToken + '&ll=' + latitude + ',' + longitude;
if(query){
		//url1+="&intent=match&query="+query;
		url1+="&query="+query;
		}
		if(limit){
		url1+="&limit="+limit;
		}
        var that = this;
		$.ajax({
             type: "GET",
            url: url1,
            dataType: 'jsonp',
            error: function () {
                alert("Fail");
            },
            success: function (data) {
			that.callback.call(undefined, data);
            }

        });

    },
	
	match: function (latitude, longitude, query, limit) {
        var url1 = 'https://api.foursquare.com/v2/venues/search?v=20140403&oauth_token=' + this.accessToken + '&ll=' + latitude + ',' + longitude;
		if(query){
		//url1+="&intent=match&query="+query;
		url1+="&query="+query;
		}
		if(limit){
		url1+="&limit="+limit;
		}
        var that = this;
        $.ajax({
            type: "GET",
            url: url1,
            dataType: 'jsonp',
            error: function () {
                alert("Fail");
            },
            success: function (data) {
			that.callback.call(undefined, data);
            }

        });

    }




}

var fourSquare = new FourSquare();
//fourSquare.match();


	</script>
    <script>
        $(document).ready(function () {


        });

        function tts(text) {
            var voiceRssKey = '026492b19f8244c0936e6450afd5ce07';
            var voiceUrl = 'http://api.voicerss.org?key=' + voiceRssKey + '&src=' + text + '&hl=en-us';
            var recommendationVoice = document.getElementById('recommendationVoice');
			var audioPlayer = document.getElementById('audioPlayer');
			recommendationVoice.src = voiceUrl;
			audioPlayer.load();
			audioPlayer.play();
        }



        function viewRoutesNames() {

            var routeLinks = document.getElementById("routeLinks");
            routeLinks.innerHTML = '';
            var routes = this.allRoutes;
			var sourceText = document.getElementById("source");
			var source = sourceText.value;
			var destinationText = document.getElementById("destination");
			var destination = destinationText.value;
			var recommend=document.getElementById("recommend");
			var fileredRoutes=[];
			var cheapestRouteIndex=0;
			for (var i = 0; i < routes.length; i++) {
				if(source!='' && destination!='' && (routes[i].source.name!=source ||routes[i].destination.name!=destination)){
						continue;
					}
				
				fileredRoutes.push(routes[i]);
				if(routes[i].price < routes[cheapestRouteIndex].price){
				cheapestRouteIndex = fileredRoutes.length-1;
				}

			}
			
			var tableRoutes ="<table style='width:100%'>";
			for (var i = 0; i < fileredRoutes.length; i++) {
                var name = fileredRoutes[i].name;
				var price=fileredRoutes[i].price;
				var rating=fileredRoutes[i].rating;
                tableRoutes +="<tr>";
               
			   tableRoutes +="<td>";
			   tableRoutes +="<a href='#routeDetail' onclick='viewRouteDetails(&quot;" + name + "&quot;);'> " + name + "</a>";
			   tableRoutes +="</td>";
			   
			   tableRoutes +="<td>";
			   tableRoutes += fileredRoutes[i].source.name  +" to " + fileredRoutes[i].destination.name;
			   tableRoutes +="</td>";
			   
			   tableRoutes +="<td>";
			   tableRoutes += "$" + price;
			   tableRoutes +="</td>";
			   
			   tableRoutes +="<td style='width:150px'>";
			   tableRoutes += "<div class='rating'>"+rating+"</div>";
			   tableRoutes +="</td>";

			   tableRoutes +="<td>";
			   if(fileredRoutes.length < routes.length && cheapestRouteIndex==i){
				tableRoutes += "<sapn style='color:red'>   recommended</span>";
				}
				tableRoutes +="</td>";
			    tableRoutes +="</tr>";
			

            }
			tableRoutes +="</table>";
			routeLinks.innerHTML +=tableRoutes;
			$('div.rating').each(function(){
			var rating = this.innerHTML;
			this.innerHTML = '';
			var intRating=parseInt(rating);
			if(intRating!=NaN){
			$(this).raty({path: '../js/plugins/raty-2.5.2/lib/img', readOnly: true, score:intRating});
			}
			$(this).attr('style','width:auto');
			
			});
			
			sourceText.value='';
			destinationText.value='';
        }

        function viewRoutes() {
            var viewRoutesDetails = document.getElementById("viewRoutesDetails");
            viewRoutesDetails.style.display = "none";


            var viewPlaceDetails = document.getElementById("viewPlaceDetails");
            viewPlaceDetails.style.display = "none";


            var viewRoutes = document.getElementById("viewRoutes");
            viewRoutes.style.display = "block";


            route.callback = viewRoutesNames;
            route.getAllRoutes();

        }

       function populateFourSquarePlace(data) {

            var placeDetails = document.getElementById("placeDetails");
            if (placeDetails) {
                for (var i = 0; i < 1; i++) {
                    var venue = data.response.venues[i];
					var address=venue.location.address;
					var phoneNumber=venue.contact.formattedPhone;
					var url=venue.url;
                    placeDetails.innerHTML = "<br/><b>"+venue.name + '</b> <br/>' + address+' <br/>' +phoneNumber+' <br/>'+"<a href='"+url+"'>"+url+"</a>";
               }
            }
       }

        function viewRoutePlacesDetails() {
            var route = this;
            var places = route.places;
			
            var placesDetails = document.getElementById("placesDetails");
            placesDetails.innerHTML = '';

            var wayPoints = [];

			        
             
            for (var i = 0; i < places.length; i++) {
                var place = places[i];
				 placesDetails.innerHTML += place.name + '<br/>';
                if (i > 0 && i < places.length - 1) {
                    wayPoints.push(new google.maps.LatLng(place.latitude, place.longitude));
                }
            }

            var source = new google.maps.LatLng(this.source.latitude, this.source.longitude);
            var destination = new google.maps.LatLng(this.destination.latitude, this.destination.longitude);;

            var mapContainer = document.getElementById("mapContainer");
            var directionContainer = document.getElementById("directionContainer");

            googleMap.direction(mapContainer, directionContainer, source, destination, wayPoints);

        }

        function viewRouteDetails(name) {
            var viewRoutes = document.getElementById("viewRoutes");
            viewRoutes.style.display = "none";

            var viewRoutesDetails = document.getElementById("viewRoutesDetails");
            viewRoutesDetails.style.display = "block";

            route.callback = viewRoutePlacesDetails;
            route.getRoute(name);
        }


        function populateFourSquareNearBy(data) {
            var nearByPlaces = document.getElementById("nearByPlaces");
            if (nearByPlaces) {
               var items = data.response.groups[0].items
			   nearByPlaces.innerHTML = '<b>Recommended Venues:</b>';
			   
             for (var i = 0; i < items.length; i++) {
                    var venue = items[i].venue;
					var address=venue.location.address;
					var phoneNumber=venue.contact.formattedPhone;
					var url=venue.url;
                    var name = "<span><br/><b>"+venue.name + '</b> <br/>' + address+' <br/>' +phoneNumber+' <br/>'+"<a href='"+url+"'>"+url+"</a>";
                    nearByPlaces.innerHTML += name + '</span>';
                }
            }
        }

        function viewPlaceDetails(first) {
            if (first && first == true) {
                route.currentPlace = 0;
            } else {
                route.currentPlace += 1;

            }
            if (route.currentPlace < route.places.length) {

                var viewRoutes = document.getElementById("viewRoutesDetails");
                viewRoutes.style.display = "none";

                var viewPlaceDetails = document.getElementById("viewPlaceDetails");
                viewPlaceDetails.style.display = "block";

                var place = route.places[route.currentPlace];
				 
				var placeImage=document.getElementById("placeImage");
				placeImage.src=place.image;
				
				var additionalInfoPlace=document.getElementById("additionalInfoPlace");
				additionalInfoPlace.innerHTML="User Comments: "+place.additionalInfo;
             
    		    var fourSquareExact = new FourSquare();
    		   
 			    fourSquareExact.callback = populateFourSquarePlace;
               
			    fourSquareExact.match(place.latitude, place.longitude, undefined, 1);
                

                fourSquare.callback = populateFourSquareNearBy;

                fourSquare.explore(place.latitude, place.longitude,undefined,5);

                var mapContainer = document.getElementById("mapContainerWalk");

                var source = new google.maps.LatLng(place.latitude, place.longitude);


                var directionContainer = document.getElementById("directionContainerWalk");
				var seeDirections=document.getElementById("seeDirections");
				seeDirections.style.display="block";
                directionContainer.innerHTML = '';
                if (route.currentPlace < route.places.length - 1) {

                    var nextPlace = route.places[route.currentPlace + 1];

                    var destination = new google.maps.LatLng(nextPlace.latitude, nextPlace.longitude);
                    googleMap.direction(mapContainer, directionContainer, source, destination, "");

                } else {
					seeDirections.style.display="none";
                    googleMap.centeredMap(mapContainer, source);
                }

                var checkIn = document.getElementById("checkIn");
                var done = document.getElementById("done");

                if (place.id != route.destination.id) {
                    checkIn.style.visibility = "visible";
                    done.style.visibility='hidden';
                } else {
                    checkIn.style.visibility = "hidden";
                    done.style.visibility='visible';
                }
            }
        }

        function createRoute() {

            var viewRoutesDetails = document.getElementById("viewRoutesDetails");
            viewRoutesDetails.style.display = "none";
            var viewRoutes = document.getElementById("viewRoutes");
            viewRoutes.style.display = "none";
            var destinationInfo = document.getElementById('createRoute');
            destinationInfo.style.display = "block";
			
			var routeInputRow = document.getElementById('routeInputRow');
		    routeInputRow.style.visibility = 'visible';
			var routePriceRow = document.getElementById('routePriceRow');
		    routePriceRow.style.visibility = 'visible';
            
			
			route=new Route();
			
        }
		
		function checkWithFourSquare(data) {
           if (data.response.venues.length > 0) {
		   var routeText = document.getElementById('route');
            if (route.places.length==0) {
                var routeText = document.getElementById('route');
                route.name = routeText.value;
            }
			
            var routeInputRow = document.getElementById('routeInputRow');
		    routeInputRow.style.visibility = 'hidden';
			var routePriceRow = document.getElementById('routePriceRow');
		    routePriceRow.style.visibility = 'hidden';
            var place = new Place();
            var venue =  data.response.venues[0];          
            place.name = venue.name;
            var commentsText = document.getElementById('comments');
            place.additionalInfo = commentsText.value;
            var pictureText = document.getElementById('picture');
            place.image = pictureText.value;
			place.latitude=venue.location.lat;
			place.longitude=venue.location.lng;
			route.places.push(place);
			routeText.value='';
			var placeText = document.getElementById('place');
            placeText.value='';
			commentsText.value='';
			pictureText.value='';
			
			
        }
		}
		
		function checkLongitudeLatitude(){
		 fourSquare.callback = checkWithFourSquare;
         fourSquare.match(googleMap.latitude, googleMap.longitude, googleMap.address);
		}
		
		
        function addPlace(newRoute) {
            var place = document.getElementById('place');
            googleMap.callback = checkLongitudeLatitude;
            googleMap.setLongitudeLatitude(place.value);
        }
		
		function addRouteCallback(response){
		
		if(response && response=='Success insert'){
		if(this.published==true){
		var createRoute = document.getElementById('createRoute');
		createRoute.style.display="none";
		viewRouteDetails(this.name);
		
		}
		
		
		
		}
		}
		function addRoute(){
		route.callback=addRouteCallback;
		route.publish();
				
		}
		
		function searchRoute(){
		viewRoutesNames.call(route);
				
		}
		
    function seeDirections(){
	
	var directionContainerWalk=document.getElementById("directionContainerWalk");
	directionContainerWalk.style.display="block";
	
	}
	
	function done(){
	
	var routeSummary=document.getElementById("routeSummary");
	routeSummary.style.display="block";
	
	var viewPlaceDetails=document.getElementById("viewPlaceDetails");
	viewPlaceDetails.style.display="none";
	
	var ratings = route.ratings;
	$("#inputRating").raty({path: '../js/plugins/raty-2.5.2/lib/img',score:ratings});
	}
	
	function listenDirections(){
	tts($("#directionContainerWalk").text()); 
	}
	
	</script>
</head>


<body background="http://www.freewebsitetemplates.com/preview/woodworkingwebsitetemplate/images/bg-body.png">
<div>
<audio id="audioPlayer">
        <source id="recommendationVoice" type="audio/mpeg" src="http://tts-api.com/tts.mp3?q=hi" />
 </audio>
 </div>


    <div class="container">
	 

        <div class="navbar">
            <div class="navbar-inner">
                <div class="container">
                    <ul class="nav">
                        <li class="active"><a href="#" onclick='window.location.reload(true);'>Home</a>
                        </li>
                        <li><a href="#">Account</a>
                        </li>
                        <li><a href="#">Careers</a>
                        </li>
                        <li><a href="#">Products & Services</a>
                        </li>
                        <li><a href="#">About US</a>
                        </li>
                        <li><a href="#">Contact Us</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="hero-unit">
            <h1 style="clear:both;margin-left:0px">My Travels</h1>
            <div style="clear:both;margin-left:0px">
                <!-- <a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="fourSquare.getToken();">Create a Route</a>-->
                <a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="createRoute();">Create a Route</a>
                <a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="viewRoutes();">Trace Route</a>
                <a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="">Walk Through a Route</a>
            </div>

        </div>

        <div id="viewRoutes" style="display:none" class="hero-unit">
       
            <div id="searchRoutes">
               <table>
                <tr>
                    <td>Source: </td>
                    <td style="padding-top:9px">
                        <input id="source" type="text" maxlength="100" value="" />
                    </td>
                    <td style="padding-left:15px">Destination: </td>
                    <td style="padding-top:9px">
                        <input id="destination" type="text" maxlength="100" value="" />
                    </td>
               
                    <td style="padding-left:15px">
                        <a data-role="button" class="btn btn-success" onclick="searchRoute();">Search</a>
                    </td>
                </tr>
            </table>
                
            </div>
			
			<div id="routeLinks">

            </div>
			<span id='recommend'></span>

        </div>

        <div id="viewRoutesDetails" style="display:none;" class="hero-unit">

            <div id="mapContainer" style="height:350px;overflow:auto">


            </div>
            <div id="directionContainer" style="height:200px;margin-top:30px;overflow:auto">

            </div>
			<span style="display:inline-block;margin-top:30px;padding-top:30px"><b>This route will cover the following destinations:</b></span>
			<br/>
            <div id="placesDetails" style="margin-top:10px;overflow:auto">

            </div>

            <a href="#viewPlaceDetails" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="viewPlaceDetails(true);">Select Route</a>
            <a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="viewRoutes();">Back</a>





        </div>

        <div id="viewPlaceDetails" style="display:none;" class="hero-unit">
		
		<table style="width:100%">
		<tr>
			<td style="width:55%; vertical-align:top">
			<span><b>Your current location </b></span>
			<span id="placeDetails"></span>
			<br/>
						
			<span id="additionalInfoPlace"></span>
			<div id="placesPictureWalk">
			<img src = "" id="placeImage" />		
			</div>
			</td>
			<td style="width:35%;padding-left:10%;text-align:right">
			<table>
			<tr>
			<td style="text-align:right";
			<div id="nearByPlaces" style="margin-top:60px;overflow:auto"></div>
			</td>
			</tr>
			</table>
			</td>
		</tr>
		<tr>
		<td colspan="2" style="padding-top:30px"> <div id="mapContainerWalk" style="height:350px;overflow:auto"></div>
			<div id='seeDirections'>
			<a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="seeDirections();">See Directions</a>
			<a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="listenDirections();">Listen Directions</a>
            <div id="directionContainerWalk" style="display:none;height:200px;margin-top:30px;overflow:auto"></div>
			</div>
			 <a href="#viewPlaceDetails" id="checkIn" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="viewPlaceDetails();">Check-in</a>
			 <a href="#" data-role="button" style="margin-top:30px" class="btn btn-large btn-success" onclick="viewRoutes();">Back</a>
			 <a href="#routeSummary" id="done" data-role="button" style="margin-top:30px;visibility:hidden" class="btn btn-large btn-success" onclick="done();">Done</a>
            
		</td>
		</tr>
		</table>
        </div>

        <div id="createRoute" style="display:none" class="hero-unit">
            <span> Enter Destination Information</span>
            <table>
                <tr id='routeInputRow'>
                    <td>Route:</td>
                    <td>
                        <input id="route" type="text" name="name" maxlength="250"/>
                    </td>
                </tr>
				<tr id='routePriceRow'>
                    <td>Price:</td>
                    <td>
                        <input id="price" type="text" name="price" maxlength="250"/>
                    </td>
                </tr>
                <tr>
                    <td>Place:</td>
                    <td>
                        <input id="place" type="text" name="name" maxlength="250"/>
                    </td>
                </tr><tr>
                    <td>Comments:</td>
                    <td>
                        <input id="comments" type="text" name="info" maxlength="250"/>
                    </td>
                </tr>
                <tr>
                    <td>Picture:</td>
                    <td>
                        <input id="picture" type="text" name="pic" maxlength="250"/>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <a href="#createRoute" data-role="button" class="btn btn-large btn-success" onclick="addPlace();">Add Destination</a>
                        <a href="#" data-role="button" class="btn btn-large btn-success" onclick="addRoute();">Publish Route</a>
                    </td>
                </tr>
            </table>
        </div>
		
		<div id="routeSummary" style="display:none" class="hero-unit">
            <span> Congratulations! you have successfully walked-through the route.</span>
			<img alt="Thumbs up" width=45 height=45 src="http://www.sherv.net/cm/emo/happy/big-grin-smiley-emoticon.gif">
            <table>
                <tr>
                    <td>
                        <div>
						<span>Please Rate the route: </span>
						<div id='inputRating'>
						</div>
						</div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <a data-role="button" class="btn btn-large btn-success" onclick="window.location.reload(true);">Home</a>
                    </td>
                </tr>
            </table>
        </div>


    </div>
</body>

</html>